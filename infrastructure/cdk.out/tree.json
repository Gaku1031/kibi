{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.222.0"},"children":{"KibiStack":{"id":"KibiStack","path":"KibiStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.222.0"},"children":{"DiaryTable":{"id":"DiaryTable","path":"KibiStack/DiaryTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/DiaryTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"id","attributeType":"S"},{"attributeName":"userId","attributeType":"S"},{"attributeName":"createdAt","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"CreatedAtIndex","keySchema":[{"attributeName":"userId","keyType":"HASH"},{"attributeName":"createdAt","keyType":"RANGE"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"id","keyType":"HASH"}],"pointInTimeRecoverySpecification":{"pointInTimeRecoveryEnabled":false},"tableName":"kibi-diary-prod"}}},"ScalingRole":{"id":"ScalingRole","path":"KibiStack/DiaryTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.222.0","metadata":[]}}}},"EmotionAnalysisTable":{"id":"EmotionAnalysisTable","path":"KibiStack/EmotionAnalysisTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/EmotionAnalysisTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"diaryId","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"diaryId","keyType":"HASH"}],"pointInTimeRecoverySpecification":{"pointInTimeRecoveryEnabled":false},"tableName":"kibi-emotion-analysis-prod"}}},"ScalingRole":{"id":"ScalingRole","path":"KibiStack/EmotionAnalysisTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.222.0","metadata":[]}}}},"ContentBucket":{"id":"ContentBucket","path":"KibiStack/ContentBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/ContentBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketName":"kibi-content-223708988018","tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}]}}},"Policy":{"id":"Policy","path":"KibiStack/ContentBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/ContentBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"ContentBucket52D4B12C"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["ContentBucket52D4B12C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ContentBucket52D4B12C","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"KibiStack/ContentBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.222.0","metadata":[]},"children":{"Default":{"id":"Default","path":"KibiStack/ContentBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.222.0"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"KibiStack/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.222.0"},"children":{"Staging":{"id":"Staging","path":"KibiStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.222.0"}},"Role":{"id":"Role","path":"KibiStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.222.0"}},"Handler":{"id":"Handler","path":"KibiStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.222.0"}}}},"ComprehendDataAccessRole":{"id":"ComprehendDataAccessRole","path":"KibiStack/ComprehendDataAccessRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.222.0","metadata":[]},"children":{"ImportComprehendDataAccessRole":{"id":"ImportComprehendDataAccessRole","path":"KibiStack/ComprehendDataAccessRole/ImportComprehendDataAccessRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.222.0","metadata":[]}},"Resource":{"id":"Resource","path":"KibiStack/ComprehendDataAccessRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"comprehend.amazonaws.com"}}],"Version":"2012-10-17"},"description":"Role for Comprehend to access S3"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"KibiStack/ComprehendDataAccessRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/ComprehendDataAccessRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ContentBucket52D4B12C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ContentBucket52D4B12C","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"ComprehendDataAccessRoleDefaultPolicy08A20564","roles":[{"Ref":"ComprehendDataAccessRole79BA93B4"}]}}}}}}},"ApiFunction":{"id":"ApiFunction","path":"KibiStack/ApiFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.DockerImageFunction","version":"2.222.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"KibiStack/ApiFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.222.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"KibiStack/ApiFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.222.0","metadata":[]}},"Resource":{"id":"Resource","path":"KibiStack/ApiFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"KibiStack/ApiFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/ApiFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:ConditionCheckItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["DiaryTableCD601749","Arn"]},{"Fn::GetAtt":["EmotionAnalysisTable0822BA9B","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["DiaryTableCD601749","Arn"]},"/index/*"]]},{"Ref":"AWS::NoValue"}]},{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ContentBucket52D4B12C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ContentBucket52D4B12C","Arn"]},"/*"]]}]},{"Action":["comprehend:DescribeDocumentClassificationJob","comprehend:DescribeDocumentClassifier","comprehend:StartDocumentClassificationJob","iam:PassRole","translate:TranslateText"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"ApiFunctionServiceRoleDefaultPolicy20A32B8D","roles":[{"Ref":"ApiFunctionServiceRole52B9747B"}]}}}}}}},"AssetImage":{"id":"AssetImage","path":"KibiStack/ApiFunction/AssetImage","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr_assets.DockerImageAsset","version":"2.222.0"},"children":{"Staging":{"id":"Staging","path":"KibiStack/ApiFunction/AssetImage/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.222.0"}},"Repository":{"id":"Repository","path":"KibiStack/ApiFunction/AssetImage/Repository","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.222.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"KibiStack/ApiFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"imageUri":{"Fn::Sub":"223708988018.dkr.ecr.ap-northeast-1.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-223708988018-ap-northeast-1:11f77566c8915670f99c576449b10a67dece37eda59db0594497583cecdf8adb"}},"environment":{"variables":{"DIARY_TABLE_NAME":{"Ref":"DiaryTableCD601749"},"EMOTION_ANALYSIS_TABLE_NAME":{"Ref":"EmotionAnalysisTable0822BA9B"},"CONTENT_BUCKET_NAME":{"Ref":"ContentBucket52D4B12C"},"PORT":"8080","READINESS_CHECK_PORT":"8080","READINESS_CHECK_PATH":"/health","COMPREHEND_DATA_ACCESS_ROLE_ARN":{"Fn::GetAtt":["ComprehendDataAccessRole79BA93B4","Arn"]},"COMPREHEND_CLASSIFIER_ARN":"arn:aws:comprehend:ap-northeast-1:223708988018:document-classifier/kibi-emotion-classifier"}},"memorySize":512,"packageType":"Image","role":{"Fn::GetAtt":["ApiFunctionServiceRole52B9747B","Arn"]},"timeout":30}}}}},"KibiHttpApi":{"id":"KibiHttpApi","path":"KibiStack/KibiHttpApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpApi","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/KibiHttpApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"corsConfiguration":{"allowHeaders":["Content-Type","Authorization"],"allowMethods":["GET","POST","PUT","DELETE","OPTIONS"],"allowOrigins":["*"],"maxAge":600},"description":"Kibi HTTP API","name":"kibi-http-api-prod","protocolType":"HTTP"}}},"DefaultStage":{"id":"DefaultStage","path":"KibiStack/KibiHttpApi/DefaultStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpStage","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/KibiHttpApi/DefaultStage/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"apiId":{"Ref":"KibiHttpApi3440C85A"},"autoDeploy":true,"stageName":"$default"}}}}},"ANY--{proxy+}":{"id":"ANY--{proxy+}","path":"KibiStack/KibiHttpApi/ANY--{proxy+}","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.222.0","metadata":[]},"children":{"LambdaIntegration":{"id":"LambdaIntegration","path":"KibiStack/KibiHttpApi/ANY--{proxy+}/LambdaIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"KibiStack/KibiHttpApi/ANY--{proxy+}/LambdaIntegration/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"KibiHttpApi3440C85A"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["ApiFunctionCE271BD4","Arn"]},"payloadFormatVersion":"2.0"}}}}},"LambdaIntegration-Permission":{"id":"LambdaIntegration-Permission","path":"KibiStack/KibiHttpApi/ANY--{proxy+}/LambdaIntegration-Permission","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ApiFunctionCE271BD4","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:ap-northeast-1:223708988018:",{"Ref":"KibiHttpApi3440C85A"},"/*/*/{proxy+}"]]}}}},"Resource":{"id":"Resource","path":"KibiStack/KibiHttpApi/ANY--{proxy+}/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"KibiHttpApi3440C85A"},"authorizationType":"NONE","routeKey":"ANY /{proxy+}","target":{"Fn::Join":["",["integrations/",{"Ref":"KibiHttpApiANYproxyLambdaIntegration6296EE39"}]]}}}}}}}},"ApiURL":{"id":"ApiURL","path":"KibiStack/ApiURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.222.0"}},"DiaryTableName":{"id":"DiaryTableName","path":"KibiStack/DiaryTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.222.0"}},"EmotionAnalysisTableName":{"id":"EmotionAnalysisTableName","path":"KibiStack/EmotionAnalysisTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.222.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"KibiStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"KibiStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.222.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"KibiStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.222.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"KibiStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.222.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}